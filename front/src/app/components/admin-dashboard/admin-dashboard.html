<div class="dashboard-container sidebar-collapsed">
  <aside class="sidebar">
    <div class="sidebar-header">
      <img src="./logo.png" alt="Logo" class="login-logo" />
    </div>
    <mat-nav-list class="nav-list">
      <a mat-list-item class="nav-item active" (click)="navigateTo('/admin')">
        <mat-icon class="nav-icon">dashboard</mat-icon>
        <span class="nav-text">Tableau de bord</span>
      </a>
      <a mat-list-item class="nav-item" (click)="navigateTo('/admin/utilisateurs')">
        <mat-icon class="nav-icon">group</mat-icon>
        <span class="nav-text">Utilisateurs</span>
      </a>
      <a mat-list-item class="nav-item" (click)="onManageDepartments()">
        <mat-icon class="nav-icon">apartment</mat-icon>
        <span class="nav-text">Départements</span>
      </a>
      <a mat-list-item class="nav-item">
        <mat-icon class="nav-icon">analytics</mat-icon>
        <span class="nav-text">Rapports</span>
      </a>
    </mat-nav-list>
  </aside>

  <main class="main-content">
    <header class="main-header">
      <div class="header-left">
        <h1 class="header-title">Tableau de bord</h1>
        <p class="header-subtitle">Vue d'ensemble des activités et statistiques</p>
      </div>
      <div class="header-actions">
        <button mat-icon-button (click)="openUserProfile()" matTooltip="Mon Profil">
          <mat-icon>account_circle</mat-icon>
        </button>
        <button mat-icon-button (click)="logout()" matTooltip="Déconnexion">
          <mat-icon>logout</mat-icon>
        </button>
      </div>
    </header>

    <section class="cards-section">
      <div class="cards-grid">
        <mat-card class="stat-card">
          <div class="card-icon-container color-users">
            <mat-icon>group</mat-icon>
          </div>
          <mat-card-content>
            <p class="stat-title">Utilisateurs Totaux</p>
            <p class="stat-value">{{ stats.totalUsers || '0' }}</p>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card">
          <div class="card-icon-container color-tickets">
            <mat-icon>confirmation_number</mat-icon>
          </div>
          <mat-card-content>
            <p class="stat-title">Tickets Actifs</p>
            <p class="stat-value">{{ stats.activeTickets || '0' }}</p>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card">
          <div class="card-icon-container color-incidents">
            <mat-icon>report_problem</mat-icon>
          </div>
          <mat-card-content>
            <p class="stat-title">Incidents Ouverts</p>
            <p class="stat-value">{{ stats.openIncidents || '0' }}</p>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card">
          <div class="card-icon-container color-closed">
            <mat-icon>check_circle</mat-icon>
          </div>
          <mat-card-content>
            <p class="stat-title">Tickets Fermés</p>
            <p class="stat-value">{{ stats.closedTickets || '0' }}</p>
          </mat-card-content>
        </mat-card>
      </div>
      <mat-divider></mat-divider> 
    </section>

    <mat-card class="table-section mat-elevation-z2">
      <h2 class="section-title">Utilisateurs récents</h2>
      <div class="table-container">
        <table mat-table [dataSource]="utilisateurs" class="dashboard-table">
          <ng-container matColumnDef="nom">
            <th mat-header-cell *matHeaderCellDef>Nom</th>
            <td mat-cell *matCellDef="let user">{{ user.nom }}</td>
          </ng-container>
          <ng-container matColumnDef="prenom">
            <th mat-header-cell *matHeaderCellDef>Prénom</th>
            <td mat-cell *matCellDef="let user">{{ user.prenom }}</td>
          </ng-container>
          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef>Email</th>
            <td mat-cell *matCellDef="let user">{{ user.email }}</td>
          </ng-container>
          <ng-container matColumnDef="role">
            <th mat-header-cell *matHeaderCellDef>Rôle</th>
            <td mat-cell *matCellDef="let user">{{ user.role }}</td>
          </ng-container>
          <ng-container matColumnDef="department">
            <th mat-header-cell *matHeaderCellDef>Département</th>
            <td mat-cell *matCellDef="let user">{{ user.department?.nom || '-' }}</td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </div>
    </mat-card>
  </main>
</div>